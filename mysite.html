<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حاسبة المعدل السنوي (حسب المادة)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        .grade-input:disabled {
            background-color: #f3f4f6;
            cursor: not-allowed;
        }
        .dark .grade-input:disabled {
            background-color: #374151;
        }
        .final-grade {
            transition: color 0.3s, transform 0.3s;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 transition-colors duration-500">
    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-5xl">
        
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 dark:text-white">حاسبة المعدل السنوي المفصّلة</h1>
            <p class="text-lg text-gray-600 dark:text-gray-300 mt-2">أدخل علاماتك ليتم حساب معدل كل مادة والمعدل العام تلقائيًا.</p>
        </header>

        <section class="mb-8 text-center bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg">
            <p class="text-xl font-semibold text-gray-600 dark:text-gray-300 mb-2">المعدل العام السنوي</p>
            <p id="finalAverageDisplay" class="text-6xl font-extrabold text-green-600 dark:text-green-400 transition-colors duration-300">0.00</p>
        </section>


        <main class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 sm:p-8">
            <div class="overflow-x-auto">
                <table class="min-w-full text-sm text-center">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                        <tr>
                            <th class="px-4 py-3 rounded-r-lg text-right">المادة</th>
                            <th class="px-4 py-3">علامة ف1</th>
                            <th class="px-4 py-3">علامة ف2</th>
                            <th class="px-4 py-3">علامة TP</th>
                            <th class="px-4 py-3">المعامل</th>
                            <th class="px-4 py-3 rounded-l-lg">معدل المادة</th>
                        </tr>
                    </thead>
                    <tbody id="subjects-table-body" class="text-gray-700 dark:text-gray-300">
                        </tbody>
                </table>
            </div>
        </main>
        
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const subjectsData = [
            { id: 'anatomie', name: 'Anatomie', coeff: 2, s1: true, s2: true, tp: false },
            { id: 'chimie', name: 'Chimie', coeff: 2, s1: true, s2: true, tp: true },
            { id: 'biophysique', name: 'Biophysique', coeff: 2, s1: true, s2: true, tp: false },
            { id: 'biochimie', name: 'Biochimie', coeff: 2, s1: true, s2: true, tp: false },
            { id: 'biostats', name: 'Biostats', coeff: 2, s1: true, s2: true, tp: false },
            { id: 'cytologie', name: 'Cytologie', coeff: 2, s1: true, s2: true, tp: true },
            { id: 'ssh', name: 'SSH', coeff: 1, s1: true, s2: false, tp: false },
            { id: 'embryologie', name: 'Embryologie', coeff: 1, s1: true, s2: false, tp: false },
            { id: 'histologie', name: 'Histologie', coeff: 1, s1: false, s2: true, tp: false },
            { id: 'physiologie', name: 'Physiologie', coeff: 1, s1: false, s2: true, tp: false },
        ];

        const tableBody = document.getElementById('subjects-table-body');
        const finalAverageDisplay = document.getElementById('finalAverageDisplay');

        const createGradeInput = (subjectId, gradeType, isEnabled) => {
            if (!isEnabled) {
                return `<input type="number" class="w-20 grade-input bg-gray-200 dark:bg-gray-600" disabled>`;
            }
            return `<input type="number" data-subject-id="${subjectId}" data-grade-type="${gradeType}" 
                           placeholder="--" step="0.25" min="0" max="20"
                           class="w-20 grade-input bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-500 text-center rounded-lg focus:ring-2 focus:ring-blue-500 p-2 transition">`;
        };
        
        const calculateAndUpdate = () => {
            let totalPoints = 0;
            let totalCoeffs = 0;

            subjectsData.forEach(subject => {
                const row = document.getElementById(`row-${subject.id}`);
                const s1Input = row.querySelector(`[data-grade-type="s1"]`);
                const s2Input = row.querySelector(`[data-grade-type="s2"]`);
                const tpInput = row.querySelector(`[data-grade-type="tp"]`);

                const s1 = s1Input && !s1Input.disabled ? parseFloat(s1Input.value) : NaN;
                const s2 = s2Input && !s2Input.disabled ? parseFloat(s2Input.value) : NaN;
                const tp = tpInput && !tpInput.disabled ? parseFloat(tpInput.value) : NaN;

                let subjectAverage = 0;
                let isCalculable = false;
                
                if (subject.tp) { // For subjects with TP
                    if (!isNaN(s1) && !isNaN(s2) && !isNaN(tp)) {
                        const theoryAvg = (s1 + s2) / 2;
                        subjectAverage = (theoryAvg * 2 + tp * 1) / 3;
                        isCalculable = true;
                    }
                } else if (subject.s1 && subject.s2) { // For subjects in both semesters
                    if (!isNaN(s1) && !isNaN(s2)) {
                        subjectAverage = (s1 + s2) / 2;
                        isCalculable = true;
                    }
                } else if (subject.s1) { // For S1-only subjects
                    if (!isNaN(s1)) {
                        subjectAverage = s1;
                        isCalculable = true;
                    }
                } else if (subject.s2) { // For S2-only subjects
                    if (!isNaN(s2)) {
                        subjectAverage = s2;
                        isCalculable = true;
                    }
                }

                const subjectAvgDisplay = row.querySelector('.subject-average');
                if(isCalculable) {
                    subjectAvgDisplay.textContent = subjectAverage.toFixed(2);
                    subjectAvgDisplay.classList.add('text-blue-600', 'dark:text-blue-400', 'font-bold');
                    totalPoints += subjectAverage * subject.coeff;
                    totalCoeffs += subject.coeff;
                } else {
                    subjectAvgDisplay.textContent = '0.00';
                    subjectAvgDisplay.classList.remove('text-blue-600', 'dark:text-blue-400', 'font-bold');
                }
            });
            
            const finalAverage = totalCoeffs > 0 ? (totalPoints / totalCoeffs) : 0;
            finalAverageDisplay.textContent = finalAverage.toFixed(2);
        };
        
        subjectsData.forEach(subject => {
            const row = document.createElement('tr');
            row.id = `row-${subject.id}`;
            row.className = 'bg-white border-b dark:bg-gray-800 dark:border-gray-700';

            row.innerHTML = `
                <td class="px-4 py-4 font-medium whitespace-nowrap text-right">${subject.name}</td>
                <td class="px-4 py-4">${createGradeInput(subject.id, 's1', subject.s1)}</td>
                <td class="px-4 py-4">${createGradeInput(subject.id, 's2', subject.s2)}</td>
                <td class="px-4 py-4">${createGradeInput(subject.id, 'tp', subject.tp)}</td>
                <td class="px-4 py-4 font-bold text-gray-800 dark:text-gray-200">${subject.coeff}</td>
                <td class="px-4 py-4 subject-average final-grade">0.00</td>
            `;
            tableBody.appendChild(row);
        });

        document.querySelectorAll('.grade-input').forEach(input => {
            input.addEventListener('input', calculateAndUpdate);
        });
    });
    </script>
</body>
</html>
